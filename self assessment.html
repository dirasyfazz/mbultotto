<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>self Assessment</title>
<link rel="stylesheet" href="app.css">
<link rel="stylesheet" href="self assessment.css">
<link rel="icon" href="data:," />
</head>

<body>
  <header class="topbar">
    <div class="brand">ðŸŽ€ Assessment Hub</div>
    <nav class="navlinks">
      <a href="index.html">Home</a>
      <a href="self assessment.html" aria-current="page">Self asessment</a>
      <a href="learning progress.html">learning progress/a>
      <a href="game.html">Game</a>
    </nav>
  </header>

  <main class="container">
    <section class="panel">
      <h1>ðŸŒ¸ Self-Assessment â€” Reading Fluency</h1>
      <p class="lead">Rate each statement from <strong>1 (Never)</strong> to <strong>5 (Always)</strong>. Enter your name to save results with your file.</p>

      <form id="selfForm" class="survey" autocomplete="off">
        <div class="meta">
          <label class="label-inline">Student name
            <input id="studentName" name="studentName" type="text" placeholder="Your name (e.g., Totto Gembul)" required>
          </label>
          <div class="meta-right">
            <button type="button" id="showScore" class="btn ghost">Show Score</button>
            <button type="button" id="exportCSV" class="btn">Export Progress to CSV</button>
          </div>
        </div>

        <table class="likert-table" role="table" aria-label="Self assessment likert table">
          <thead>
            <tr>
              <th class="qcol">Question</th>
              <th>1<br><small>Never</small></th>
              <th>2</th>
              <th>3<br><small>Sometimes</small></th>
              <th>4</th>
              <th>5<br><small>Always</small></th>
            </tr>
          </thead>
          <tbody id="questionsBody">
            <!-- JS will populate -->
          </tbody>
        </table>

        <div class="result-row" id="resultRow" aria-live="polite" hidden>
          <div class="result-box">
            <strong>Total:</strong> <span id="totalScore">0</span> /
            <span id="maxScore">100</span>
            &nbsp;&middot;&nbsp;
            <strong>Average:</strong> <span id="avgScore">0</span>
          </div>
        </div>

        <p class="note">Tip: You must answer all items before exporting.</p>
      </form>
    </section>
  </main>

  <script>
    // Questions
    const questions = [
      "Can I read and recognize common sight words without having to sound them out?",
      "When I read aloud, do I notice when I mix up words like 'pat' and 'bat'?",
      "Can I break down unfamiliar words into smaller sound components (phonemes/syllables)?",
      "Do I pronounce every sound smoothly and clearly when I read aloud?",
      "Do I feel comfortable reading unfamiliar words not in memory?",
      "When I read, do I sometimes substitute words (use a different printed word)?",
      "When reading aloud, how often do I pronounce words incorrectly or omit them?",
      "Do I ever flip or reword words or letters (reading 'was' as 'saw')?",
      "Do I acknowledge my mistakes and try to correct myself?",
      "Do I frequently hesitate or pause when I am unsure of a word?",
      "Do I pay attention to punctuation (commas, periods, question marks)?",
      "Does my tone and expression match the text's meaning?",
      "Do I sometimes read in a flat tone or ignore punctuation?",
      "Can I read fluently without pausing frequently to decode words?",
      "What is my estimated fluency (words correct per minute)? (choose 1â€“5)",
      "Is my reading speed appropriate for my grade, or do I often need more time?",
      "Do I understand most of the text when reading independently?",
      "Do I sometimes need teacher/peer assistance to understand parts of the text?",
      "Does my reading difficulty relate to learning issues (attention, decoding)?",
      "Do I have trouble reading due to hearing/vision/focus or other physical issues?"
    ];

    // Build table
    const tbody = document.getElementById('questionsBody');
    questions.forEach((q, idx) => {
      const id = `q${idx+1}`;
      const tr = document.createElement('tr');
      const qcell = document.createElement('td');
      qcell.className = 'qcol';
      qcell.innerHTML = `<div class="qnum">${idx+1}.</div><div class="qtext">${q}</div>`;
      tr.appendChild(qcell);
      for(let v=1; v<=5; v++){
        const td = document.createElement('td');
        td.innerHTML = `<input type="radio" name="${id}" value="${v}" aria-label="Rate ${v}" required>`;
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    });

    // Helpers
    function collectResponses(formIdPrefix = 'q'){
      const data = [];
      for(let i=1;i<=questions.length;i++){
        const name = `${formIdPrefix}${i}`;
        const radios = document.getElementsByName(name);
        let value = null;
        for(const r of radios) if(r.checked) value = r.value;
        data.push(value === null ? '' : value);
      }
      return data;
    }

    function validateAllAnswered(arr){
      return arr.every(x => x !== '' && x !== null);
    }

    function computeScore(arr){
      // total = sum of numeric values; max = questions.length * 5
      const nums = arr.map(x => Number(x));
      const total = nums.reduce((s,n)=>s + (isNaN(n)?0:n),0);
      const max = questions.length * 5;
      const avg = (total / questions.length).toFixed(2);
      return { total, max, avg };
    }

    function getTimestampString(){
      const d = new Date();
      const pad = n => String(n).padStart(2,'0');
      return `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}_${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;
    }

    // Show Score button -> calculates and displays
    document.getElementById('showScore').addEventListener('click', ()=>{
      const resp = collectResponses();
      if(!validateAllAnswered(resp)){
        alert('Please answer all questions first to show score.');
        return;
      }
      const {total, max, avg} = computeScore(resp);
      document.getElementById('totalScore').textContent = total;
      document.getElementById('maxScore').textContent = max;
      document.getElementById('avgScore').textContent = avg;
      document.getElementById('resultRow').hidden = false;
      // scroll into view for small screens
      document.getElementById('resultRow').scrollIntoView({behavior:'smooth', block:'center'});
    });

    // Export CSV
    document.getElementById('exportCSV').addEventListener('click', ()=>{
      const nameField = document.getElementById('studentName');
      const studentName = nameField.value.trim();
      if(!studentName){
        alert('Please enter student name before exporting.');
        nameField.focus();
        return;
      }
      const resp = collectResponses();
      if(!validateAllAnswered(resp)){
        alert('Please answer all questions before exporting.');
        return;
      }
      const {total, max, avg} = computeScore(resp);

      // Build CSV lines
      const rows = [];
      rows.push(['Student Name', studentName]);
      rows.push(['Page', 'Self-Assessment â€” Reading Fluency']);
      rows.push(['Timestamp', new Date().toLocaleString()]);
      rows.push([]);
      // header
      const header = ['Question #','Question Text','Response (1-5)'];
      rows.push(header);
      questions.forEach((q,i)=>{
        rows.push([i+1, q, resp[i]]);
      });
      rows.push([]);
      rows.push(['Total', total]);
      rows.push(['Max', max]);
      rows.push(['Average', avg]);

      // Convert to CSV string
      const csvContent = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\r\n');

      // Filename sanitized
      const safeName = studentName.replace(/\s+/g,'_').replace(/[^\w\-]/g,'');
      const ts = getTimestampString();
      const filename = `${safeName}_SelfAssessment_${ts}.csv`;

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // small accessibility: pressing Enter on name focuses first unanswered
    document.getElementById('studentName').addEventListener('keydown', (e)=>{
      if(e.key === 'Enter') {
        e.preventDefault();
        const firstRadio = document.querySelector('input[type=radio]');
        if(firstRadio) firstRadio.focus();
      }
    });
  </script>
</body>
</html>

